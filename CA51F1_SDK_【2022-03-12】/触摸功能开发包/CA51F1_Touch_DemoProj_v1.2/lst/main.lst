C51 COMPILER V9.02   MAIN                                                                  01/06/2022 11:25:27 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\hex\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(9,SIZE) BROWSE DEBUG PRINT(.\lst\main.lst) OBJECT(.
                    -\hex\main.obj)

line level    source

   1          #ifndef _MAIN_C_
   2          #define _MAIN_C_
   3          /*********************************************************************************************************
             -************/
   4          #include "ca51f1_config.h"
   5          #include "includes\ca51f1sfr.h"
   6          #include "includes\ca51f1xsfr.h"
   7          #include "includes\gpiodef_f1.h"
   8          
   9          #include "Library\includes\uart.h"
  10          #include "Library\includes\system_clock.h"
  11          #include "Library\Includes\tmc.h"       
  12          #include "includes\system.h"
  13          #include "Library\includes\wdt.h"
  14          /*********************************************************************************************************
             -************/
  15          #include "TS_Lib\Includes\ts_configuration.h"
  16          #include "TS_Lib\Includes\ts_def.h"
  17          #include "TS_Lib\Includes\ts_api.h"
  18          #include "TS_Lib\Includes\ts_service.h"
  19          /*********************************************************************************************************
             -************/
  20          
  21          /*********************************************************************************************************
             -**********************************
  22          ËµÃ÷£º
  23          ----------------------------------------------------------------------------------------------------------
             ---
  24          1.ts_configuration.hÊÇ´¥ÃþµÄÅäÖÃÎÄ¼þ£¬¿ÉÔÚÅäÖÃÎÄ¼þÖÐÉèÖÃ´¥ÃþÍ¨µÀ¡¢ÁéÃô¶ÈµÈ¡£Ïê¼ûts_configuration.hÖÐµÄËµÃ÷
             -¡£
  25          ----------------------------------------------------------------------------------------------------------
             ---
  26          2.Èç¹ûÐèÒªÊ¹ÓÃUARTÀ´µ÷ÊÔ£¬¿ÉÔÚca51f1_config.hÖÐ´ò¿ªºê¶¨ÒåUART_EN
  27          ----------------------------------------------------------------------------------------------------------
             ---
  28          3.´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿ÚÎªKeysFlagSN£¬ÓÃ»§¿É¸ù¾ÝKeysFlagSNµÄÖµÀ´ÅÐ¶Ï´¥Ãþ¼üÊÇ·ñ°´ÏÂ£¨Èç¹û´¥Ãþ¼ü°´ÏÂ£¬KeysFlag
             -SN
  29          µÄ¶ÔÓ¦Î»Ò»Ö±Îª1£¬´¥Ãþ¼üËÉ¿ª£¬¶ÔÓ¦Î»±äÎª0£©£¬TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÄÖµÉú³ÉµÄ°´¼üÏûÏ¢£¬ÓÃ»§Èç²»Ê¹ÓÃ¿ÉºöÂÔ¡£
  30          ----------------------------------------------------------------------------------------------------------
             ---
  31          4.Ê¹ÄÜÁË´¥ÃþÊ¡µçÄ£Ê½ºó£¬ÔÚÎÞ°´¼üÊ±£¬ÔÚ¶¨ÒåµÄÊ±¼äºó»á½øÈëÊ¡µçÄ£Ê½£¬½øÈëÊ¡µçÄ£Ê½Ç°»á¹Ø±ÕTMCÖÐ¶ÏºÍ´¥ÃþÖÐ¶Ï£¨×
             -¢Òâ£¬×Ü
  32          ÖÐ¶ÏÈÔÊÇ¿ªÆôµÄ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂ£¬CPU»á½øÈëSTOPÄ£Ê½£¬ÔÚ±»´¥Ãþ»½ÐÑºó£¬³ÌÐòÔÚÊ¡µçº¯Êý£¨TS_EnterSleepMode£©
             -µÄÑ­»·ÄÚÔËÐÐ£¨×¢Òâ£¬´¥ÃþÊ¡µçÄ£Ê½³ÌÐò²»
  33          »áÔÚÖ÷Ñ­»·ÄÚÔËÐÐ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂÈç¹û»¹ÒªÏìÓ¦ÆäËûÖÐ¶Ï£¬ÓÃ»§ÐèÔÚ½øÈë´¥ÃþÊ¡µçÄ£Ê½Ç°×ÔÐÐ¿ªÆôÆäËûÖÐ¶Ï£¬
  34          Èç¹ûÐèÒªÍË³öÊ¡µçÄ£Ê½£¬ÓÃ»§Ö»ÐèÒªÔÚÊ¡µçº¯ÊýÑ­»·ÄÚ¼ÓÈëÌõ¼þÅÐ¶Ï£¬Ìø³öÑ­»·¼´¿É¡£
  35          
  36          ±äÁ¿TS_SleepEnÊÇ¿ØÖÆ´¥ÃþÊ¡µçÄ£Ê½µÄ¿ª¹Ø£¬Èç¹ûÏ£Íû³ÌÐòÔÚÄ³Ð©Ìõ¼þÏÂ²»½øÈëÊ¡µçÄ£Ê½£¬Ö»ÐèÔÚ´ËÌõ¼þÏÂÉèÖÃTS_Sleep
             -En = 0£»
  37          
  38          
  39          ----------------------------------------------------------------------------------------------------------
             ---
  40          5.´¥ÃþÍâ¹ÒµçÈÝ(¼´TK_CAPÒý½ÅÁ¬½ÓµçÈÝ)·¶Î§£º6nF~50nF,½¨ÒéÖµ£º20nF£¨¼´203£©
C51 COMPILER V9.02   MAIN                                                                  01/06/2022 11:25:27 PAGE 2   

  41          ----------------------------------------------------------------------------------------------------------
             ---
  42          6.´¥ÃþÒý½Å´®Áªµç×è·¶Î§£º0~5K£¬½¨ÒéÖµ£º1KÅ·Ä·£¬Èç¹ûÓÐ¿¹¶Ô½²»úµÈµç´Å¸ÉÈÅÒªÇó£¬ ´Ëµç×èÖÁÉÙ3KÒÔÉÏ¡£
  43          **********************************************************************************************************
             -*********************************/
  44          void SystemInit(void)
  45          {
  46   1      #ifdef LVD_RST_ENABLE
  47   1              LVDCON = 0xE0;          //ÉèÖÃLVD¸´Î»µçÑ¹Îª2.2V
  48   1      #endif
  49   1      
  50   1      #ifdef SYSCLK_16MHZ     
                      CKDIV = 0;
              #endif
  53   1      
  54   1      #ifdef UART_EN
                      Uart_Initial(UART_BAUTRATE);
              #endif  
  57   1              
  58   1      //¿´ÃÅ¹·Ê±ÖÓÔ´ÎªIRCL
  59   1              CKCON |= ILCKE;                                                                 //Ê¹ÄÜIRCL
  60   1              WDCON  = WDTS(WDTS_IRCL) | WDRE(WDRE_reset);    //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªILCKE£¬Ä£Ê½Îª¸´Î»Ä£Ê½
  61   1              WDVTHH = 0;                                                                             //¿´ÃÅ¹·¸´Î»ãÐÖµ¸ß°ËÎ»ÉèÖÃ µ±Ç°ÖµÎª5s   
  62   1              WDVTHL = 75;                                                                    //¿´ÃÅ¹·¸´Î»ãÐÖµµÍ°ËÎ»ÉèÖÃ
  63   1              WDFLG = 0xA5;   
  64   1      }
  65          void main(void)
  66          {       
  67   1              SystemInit();
  68   1              
  69   1              EA = 1;
  70   1      
  71   1              TS_init();              
  72   1              
  73   1              while(1)
  74   1              {                                               
  75   2                      TS_Action();
  76   2                      
  77   2      #if SUPPORT_KEY
  78   2      /*********************************************************************************************************
             -*******
  79   2      ±äÁ¿KeysFlagSNÊÇ´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿Ú£¬KeysFlagSNµÄÃ¿Ò»Î»¶ÔÓ¦Ò»¸ö´¥Ãþ¼üµÄ×´Ì¬£¬Îª1±íÊ¾´¥Ãþ¼ü´¥·¢¡£¿É¶à¼üÍ¬Ê
             -±´¥·¢¡£
  80   2      **********************************************************************************************************
             -******/
  81   2                      if(KeysFlagSN != 0)
  82   2                      {
  83   3                              switch(KeysFlagSN)
  84   3                              {
  85   4                                      case 0x01:
  86   4                                              break;
  87   4                                      case 0x02:
  88   4                                              break;
  89   4                                      //......
  90   4                                      default:
  91   4                                              break;
  92   4                              }
  93   3                      }
  94   2      #if GENERATE_TS_KEY_EN
              /*************************************************************************************************
              ±äÁ¿TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÃµ½µÄ°´¼üÐÅÏ¢£¬ÒÔÏÂÎª°´¼ü²úÉúµÄ¹ý³Ì£º
              |---------------------------------------------------------------------------------------------------------
C51 COMPILER V9.02   MAIN                                                                  01/06/2022 11:25:27 PAGE 3   

             ---------------------------|
              |       µ¥¼ü£ºÒÔK1ÎªÀý£¬K1°´¼ü²úÉúµÄÁ÷³ÌÈçÏÂËùÊ¾£º                                                                                                                                                                                                                                                                                                                                                              |
              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
              |                                               |---> K1|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                                                                                                                                                                                                                                                                                                            |
              |       K1(°´ÏÂ)--|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
              |                                               |---> K1|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> K1|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉúÒ»´Î³¤°´¼ü)---->K1|KEY
             -_LONG_BREAK(³¤°´ËÉ¿ª) |
              |                                                                                                                                                                                                ^                                                                                                                                                                                          |                                                                                                                           |
              |                                                                                                                                                                                                |                                                                                                                                                                                          |                                                                                                                           |
              |                                                                                                                                                                                                |----------<-----------<------------<--------------|                                                                                                                           |
              |---------------------------------------------------------------------------------------------------------
             ---------------------------|
              
              |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
              |       ¸´ºÏ¼ü£ºÒÔK1(K1=0x0001),K2(K2=0x0002)ÎªÀý£¬ µ±K1£¬K2Í¬Ê±°´ÏÂÊ±£¬²úÉú°´¼üÎª(K1<<5)|K2£¬¼´0x22, ²úÉú°´¼üµÄ
             -Á÷³ÌÈçÏÂËùÊ¾£º                                                                                                                                                                                                |
              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
              |                                                                               |---> ((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
              |       (K1<<5)|K2(°´ÏÂ)--|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
              |                                                                               |---> ((K1<<5)|K2)|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> ((K1<<5)|K2)|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉ
             -ú³¤°´¼ü)---->((K1<<5)|K2)|KEY_LONG_BREAK(³¤°´ËÉ¿ª)            |
              |                                                                                                                                                                                                                                                                        ^                                                                                                                                                                                                 |                                                                                                                                                                    |
              |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                 |                                                                                                                                                                    |
              |                                                                                                                                                                                                                                                                        |---------<-------------<----------------<----------------|                                                                                    
             -                                                                                |
              |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
                                                                                                                                                                                                                                                                       
              ×¢Òâ£ºÓÉÓÚ¸´ºÏ¼ü°´ÏÂÊ±£¬Èí¼þ²»Ò»¶¨Í¬Ê±¼ì²âµ½Ë«¼ü£¬¶øÊÇÏÈ¼ì²âµ½µ¥¼ü°´ÏÂ£¬ÀýÈçÏÈ¼ì²âµ½K1£¬´ËÊ±»áÏÈ²úÉúK1¼ü£¬
             -µÈµ½¼ì²âµ½K2Ò²°´
              ÏÂÊ±£¬²Å»á²úÉú°´¼ü(K1<<5)|K2£¬¼ì²âµ½Ë«¼üºó£¬Èç¹ûË«¼üÒ»Ö±°´ÏÂ£¬»á²úÉú((K1<<5)|K2)|KEY_LONG_STARTºÍ((K1<<5)|
             -K2)|KEY_LONG£¬Èç¹û
              ÓÐÒ»¸ö¼üÏÈËÉÊÖ£¬»áÍ£Ö¹²úÉú°´¼ü£¬ µÈµ½Ë«¼ü¶¼ËÉ¿ªÊ±£¬²Å»á²úÉú((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)»ò((K1<<5)|K2)|
             -KEY_LONG_BREAK(³¤°´ËÉ¿ª)
              *************************************************************************************************/
                              if(TS_Key != 0)
                              {
                                      switch(TS_Key)
                                      {
                                              //µ¥°´¼üÏûÏ¢
                                              case K1:                                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case (K1|KEY_BREAK):                            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case (K1|KEY_LONG_START):                       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
                                                      break;
                                              case (K1|KEY_LONG):                                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
                                                      break;
                                              case (K1|KEY_LONG_BREAK):                       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
                                                      break;
              
                                              case K2:                                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case (K2|KEY_BREAK):                            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case (K2|KEY_LONG_START):                       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
                                                      break;
                                              case (K2|KEY_LONG):                                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
                                                      break;
                                              case (K2|KEY_LONG_BREAK):                       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
C51 COMPILER V9.02   MAIN                                                                  01/06/2022 11:25:27 PAGE 4   

                                                      break;
              
              #if GENERATE_DOUBLE_KEY_EN                              
                      //¸´ºÏ¼üÏûÏ¢
                                              case (K1<<5)|K2:                                        //K1ºÍK2Í¬Ê±°´ÏÂÊ±²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case ((K1<<5)|K2)|KEY_BREAK:            //K1ºÍK2¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG_START:       //K1ºÍK2³¤°´¿ªÊ¼²úÉúµÄ°´¼üÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG:                     //K1ºÍK2³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG_BREAK:       //K1ºÍK2³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
                                                      break;
              #endif
                                      }
                              }
              #endif
 167   2      #endif
 168   2              }
 169   1      }
 170          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     34    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
