C51 COMPILER V9.54   AUART                                                                 07/21/2021 17:51:53 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AUART
OBJECT MODULE PLACED IN .\output\AUart.obj
COMPILER INVOKED BY: D:\My_Soft\KeilC51\Setup\C51\BIN\C51.EXE AnalogUart\AUart.c OMF2 OPTIMIZE(9,SPEED) BROWSE DEBUG PRI
                    -NT(.\lst\AUart.lst) TABS(2) OBJECT(.\output\AUart.obj)

line level    source

   1          #ifndef _auart_c_
   2          #define _auart_c_
   3          /*********************************************************************************************************
             -************/
   4          #include "include/ca51f1_config.h"    
   5          #include "include/ca51f1sfr.h"
   6          #include "include/ca51f1xsfr.h"
   7          #include "include/gpiodef_f1.h"
   8          
   9          #include "include/uart.h"
  10          #include "include/delay.h"
  11          #include <intrins.h>
  12          #include "AnalogUart/AUart.h"   
  13          /*********************************************************************************************************
             -************/
  14          
  15          
  16          /*
  17          4800波特率 -> 1/4800 = 208us；  208us发送一位数据； 
  18          */
  19          #define TIMER0_INT_TIME     208     //定时时间，单位为us
  20          #define TH0_VAL       (unsigned char)((0x10000 - (TIMER0_INT_TIME*(FOSC/1000))/12000)>>8)
  21          #define TL0_VAL       (unsigned char)(0x10000 - (TIMER0_INT_TIME*(FOSC/1000))/12000)
  22          
  23          //TXD
  24          #define SET_TX_PIN_OUTPUT   GPIO_Init(P01F,OUTPUT)
  25          #define TX_PIN P01  
  26          bit bAUartSendData;
  27          //unsigned char xdata TxPulseTab[9];
  28          unsigned char TxPulseTab[9];
  29          unsigned char TxIndex;
  30          unsigned char AUartTxThread = 0;
  31          
  32          void TIMER0_ISR (void) interrupt 1    
  33          {
  34   1        TH0 = TH0_VAL;
  35   1        TL0 = TL0_VAL;
  36   1        if(bAUartSendData){
  37   2          AUartTxThread++;           
  38   2          TX_PIN = TxPulseTab[AUartTxThread-1];
  39   2          if(AUartTxThread == 9){     
  40   3            TX_PIN =1;
  41   3          }
  42   2          else if(AUartTxThread == 10){
  43   3            bAUartSendData = 0;
  44   3            TR0 = 0;
  45   3          }
  46   2        }
  47   1      }
  48          
  49          void AUart_Send_Data(unsigned char SendData)
  50          {
  51   1        unsigned char i;
  52   1        while(bAUartSendData);
C51 COMPILER V9.54   AUART                                                                 07/21/2021 17:51:53 PAGE 2   

  53   1        for(i=0;i<8;i++)
  54   1        {  
  55   2          TxPulseTab[i] = SendData & 0x01;             
  56   2          SendData = SendData >> 1;         
  57   2        } 
  58   1        TH0 = TH0_VAL;
  59   1        TL0 = TL0_VAL;
  60   1        TR0 = 1;
  61   1        AUartTxThread = 0;
  62   1        TxIndex = 0;
  63   1        TX_PIN = 0;          
  64   1        bAUartSendData = 1;
  65   1      }
  66          
  67          
  68          void Timer0_init(void)
  69          {
  70   1        TMOD |= (TMOD&0xFC)|0x01; //模式选择: 定时器0，模式1。
  71   1        TH0 = TH0_VAL;              //高8位装初值
  72   1        TL0 = TL0_VAL;              //低8位装初值
  73   1        TR0 = 0;       //定时器0使能  
  74   1        ET0 = 1;       //定时器0中断使能
  75   1        PT0 = 0;       //设置定时器0中断优先级为低优先级
  76   1      }
  77          
  78          
  79          
  80          void AUart_Send_Init(void)
  81          {
  82   1        Timer0_init();
  83   1        bAUartSendData = 0;
  84   1        AUartTxThread = 0;
  85   1        TxIndex = 0;
  86   1        SET_TX_PIN_OUTPUT;
  87   1        TX_PIN = 1;
  88   1      }
  89          
  90          
  91          void AUart_Test(void)
  92          { 
  93   1        AUart_Send_Init();
  94   1      
  95   1        while(1)
  96   1        { 
  97   2          AUart_Send_Data(0x22);
  98   2          AUart_Send_Data(0x55);
  99   2          Delay_ms(2);
 100   2        
 101   2        }
 102   1      }
 103          /*********************************************************************************************************
             -************/
 104          #endif
 105          
 106          
 107          
 108          
 109          
 110          
 111          


C51 COMPILER V9.54   AUART                                                                 07/21/2021 17:51:53 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
