C51 COMPILER V9.02   MAIN                                                                  05/12/2022 13:56:07 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\hex\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(9,SIZE) BROWSE DEBUG PRINT(.\lst\main.lst) OBJECT(.\he
                    -x\main.obj)

line level    source

   1          #ifndef _MAIN_C_
   2          #define _MAIN_C_
   3          /*********************************************************************************************************
             -************/
   4          #include "ca51f_config.h"
   5          #include "includes\ca51f3sfr.h"
   6          #include "includes\ca51f3xsfr.h"
   7          #include "includes\gpiodef_f3.h"
   8          
   9          #include "Library\includes\delay.h"
  10          #include "Library\includes\uart.h"
  11          #include "Library\includes\system_clock.h"
  12          #include "Library\Includes\rtc.h"       
  13          #include "Library\Includes\pwm.h"       
  14          #include "includes\system.h"
  15          #include "Library\includes\adc.h"
  16          #include "Library\includes\wdt.h"
  17          /*********************************************************************************************************
             -************/
  18          #include "TS_Lib\Includes\ts_configuration.h"
  19          #include "TS_Lib\Includes\ts_def.h"
  20          #include "TS_Lib\Includes\ts_api.h"
  21          #include "TS_Lib\Includes\ts_service.h"
  22          /*********************************************************************************************************
             -************/        
  23          /********************************************************************************************************
  24          ËµÃ÷£º
  25          ----------------------------------------------------------------------------------------------------------
             ---
  26          1.ts_configuration.hÊÇ´¥ÃþµÄÅäÖÃÎÄ¼þ£¬¿ÉÔÚÅäÖÃÎÄ¼þÖÐÉèÖÃ´¥ÃþÍ¨µÀ¡¢ÁéÃô¶ÈµÈ¡£Ïê¼ûts_configuration.hÖÐµÄËµÃ÷
             -¡£
  27          ----------------------------------------------------------------------------------------------------------
             ---
  28          2.Èç¹ûÐèÒªÊ¹ÓÃUARTÀ´µ÷ÊÔ£¬¿ÉÔÚca51f_config.hÖÐ´ò¿ªºê¶¨ÒåUART0_EN
  29          ----------------------------------------------------------------------------------------------------------
             ---
  30          3.´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿ÚÎªKeysFlagSN£¬ÓÃ»§¿É¸ù¾ÝKeysFlagSNµÄÖµÀ´ÅÐ¶Ï´¥Ãþ¼üÊÇ·ñ°´ÏÂ£¨Èç¹û´¥Ãþ¼ü°´ÏÂ£¬KeysFlag
             -SN
  31          µÄ¶ÔÓ¦Î»Ò»Ö±Îª1£¬´¥Ãþ¼üËÉ¿ª£¬¶ÔÓ¦Î»±äÎª0£©£¬TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÄÖµÉú³ÉµÄ°´¼üÏûÏ¢£¬ÓÃ»§Èç²»Ê¹ÓÃ¿ÉºöÂÔ¡£
  32          ----------------------------------------------------------------------------------------------------------
             ---
  33          4.Ê¹ÄÜÁË´¥ÃþÊ¡µçÄ£Ê½ºó£¬ÔÚÎÞ°´¼üÊ±£¬ÔÚ¶¨ÒåµÄÊ±¼äºó»á½øÈëÊ¡µçÄ£Ê½£¬½øÈëÊ¡µçÄ£Ê½Ç°»á¹Ø±ÕTMCÖÐ¶ÏºÍ´¥ÃþÖÐ¶Ï£¨×
             -¢Òâ£¬
  34          ×ÜÖÐ¶ÏÈÔÊÇ¿ªÆôµÄ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂ£¬CPU»á½øÈëSTOPÄ£Ê½£¬ÔÚ±»´¥Ãþ»½ÐÑºó£¬³ÌÐòÔÚÊ¡µçº¯Êý£¨TS_EnterSleepMode
             -£©
  35          µÄÑ­»·ÄÚÔËÐÐ£¨×¢Òâ£¬´¥ÃþÊ¡µçÄ£Ê½³ÌÐò²»»áÔÚÖ÷Ñ­»·ÄÚÔËÐÐ£©£¬ÔÚ´¥ÃþÊ¡µçÄ£Ê½ÏÂÈç¹û»¹ÒªÏìÓ¦ÆäËûÖÐ¶Ï£¬ÓÃ»§ÐèÔÚ½ø
             -Èë
  36          ´¥ÃþÊ¡µçÄ£Ê½Ç°×ÔÐÐ¿ªÆôÆäËûÖÐ¶Ï£¬Èç¹ûÐèÒªÍË³öÊ¡µçÄ£Ê½£¬ÓÃ»§Ö»ÐèÒªÔÚÊ¡µçº¯ÊýÑ­»·ÄÚ¼ÓÈëÌõ¼þÅÐ¶Ï£¬Ìø³öÑ­»·¼´¿É
             -¡£
  37          
  38          ±äÁ¿TS_SleepEnÊÇ¿ØÖÆ´¥ÃþÊ¡µçÄ£Ê½µÄ¿ª¹Ø£¬Èç¹ûÏ£Íû³ÌÐòÔÚÄ³Ð©Ìõ¼þÏÂ²»½øÈëÊ¡µçÄ£Ê½£¬Ö»ÐèÔÚ´ËÌõ¼þÏÂÉèÖÃTS_Sleep
             -En = 0£»
  39          ----------------------------------------------------------------------------------------------------------
             ---
C51 COMPILER V9.02   MAIN                                                                  05/12/2022 13:56:07 PAGE 2   

  40          5.´¥ÃþÍâ¹ÒµçÈÝ(¼´TK_CAPÒý½ÅÁ¬½ÓµçÈÝ)·¶Î§£º10nF~47nF,½¨ÒéÖµ£º22nF£¨¼´223£©
  41          ----------------------------------------------------------------------------------------------------------
             ---
  42          6.´¥ÃþÒý½Å´®Áªµç×è·¶Î§£º0~5K£¬½¨ÒéÖµ£º1KÅ·Ä·£¬Èç¹ûÓÐ¿¹¶Ô½²»úµÈµç´Å¸ÉÈÅÒªÇó£¬ ´Ëµç×èÖÁÉÙ3KÒÔÉÏ¡£
  43          ********************************************************************************************************/
  44          unsigned char read_inner_trim(void)                             
  45          {
  46   1              unsigned char value;
  47   1              FSCMD = 0x80;   
  48   1              PTSH = 0x00;                            
  49   1              PTSL = 0x24;      
  50   1              FSCMD = 0x81;                                           
  51   1              value = FSDAT;
  52   1              FSCMD = 0;
  53   1              return value;
  54   1      }
  55          void SystemInit(void)
  56          {
  57   1      #ifdef LVD_RST_ENABLE
  58   1              LVDCON = 0xE1;  //ÉèÖÃLVD¸´Î»µçÑ¹Îª2V
  59   1      #endif
  60   1      #if (SYSCLK_SRC == PLL)
  61   1              Sys_Clk_Set_PLL(PLL_Multiple);  
  62   1      #endif
  63   1      #ifdef UART0_EN
                      Uart0_Initial(UART0_BAUTRATE);
              #endif
  66   1      #ifdef UART1_EN
                      Uart1_Initial(UART1_BAUTRATE);
              #endif
  69   1      
  70   1      #if (RTC_CLK_SELECT == IRCL)
  71   1      //¿´ÃÅ¹·Ê±ÖÓÔ´ÎªIRCL
  72   1              CKCON |= ILCKE;                                                                 //Ê¹ÄÜIRCL
  73   1              WDCON  = WDTS(WDTS_IRCL) | WDRE(WDRE_reset);    //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªILCKE£¬Ä£Ê½Îª¸´Î»Ä£Ê½
  74   1      #elif (RTC_CLK_SELECT == XOSCL) 
                      CKCON |= XLCKE;
                      while(!(CKCON & XLSTA));
                      WDCON  = WDTS(WDTS_XOSCL) | WDRE(WDRE_reset);   //ÉèÖÃ¿´ÃÅ¹·Ê±ÖÓÔ´ÎªXOSCL£¬Ä£Ê½Îª¸´Î»Ä£Ê½
              #endif
  79   1              WDVTHH = 0;                                                                             //¿´ÃÅ¹·¸´Î»ãÐÖµ¸ß°ËÎ»ÉèÖÃ µ±Ç°ÖµÎª5s   
  80   1              WDVTHL = 75;                                                                    //¿´ÃÅ¹·¸´Î»ãÐÖµµÍ°ËÎ»ÉèÖÃ
  81   1              WDFLG = 0xA5;   
  82   1              
  83   1              
  84   1              ADCFGH = (ADCFGH&0xC0) | VTRIM(read_inner_trim());      //¼ÓÔØADCÄÚ²¿»ù×¼Ð£×¼Öµ
  85   1      }
  86          void main(void)
  87          {
  88   1              SystemInit();
  89   1      
  90   1              EA = 1;
  91   1      
  92   1              TS_init();      
  93   1      
  94   1              while(1)
  95   1              {                       
  96   2                      TS_Action();
  97   2      #if SUPPORT_WHEEL_SLIDER
                              if(WheelSliderPosition != -1)
                              {
                                      //µ±WheelSliderPosition²»µÈÓÚ-1Ê±£¬ ±íÊ¾»¬Ìõ»òÔ²»·ÓÐ´¥ÃþÊÂ¼þ·¢Éú¡£WheelSliderPositionµÄÖµ±íÊ¾»¬Ìõ»òÔ²»·
C51 COMPILER V9.02   MAIN                                                                  05/12/2022 13:56:07 PAGE 3   

             -µÄÎ»ÖÃ¡£
                              }
              #endif
 103   2      #if SUPPORT_KEY
 104   2      /*************************************************************************************************
 105   2      ±äÁ¿KeysFlagSNÊÇ´¥Ãþ¿â¶ÔÍâµÄÊý¾Ý½Ó¿Ú£¬KeysFlagSNµÄÃ¿Ò»Î»¶ÔÓ¦Ò»¸ö´¥Ãþ¼üµÄ×´Ì¬£¬Îª1±íÊ¾´¥Ãþ¼ü´¥·¢¡£¿É¶à¼üÍ¬Ê
             -±´¥·¢¡£
 106   2      *************************************************************************************************/
 107   2                      if(KeysFlagSN != 0)
 108   2                      {
 109   3                              switch(KeysFlagSN)
 110   3                              {
 111   4                                      case 0x0001:
 112   4                                              break;
 113   4                                      case 0x0002:
 114   4                                              break;
 115   4                                      case 0x0004:
 116   4                                              break;
 117   4                                      //......
 118   4                                      default:
 119   4                                              break;
 120   4                              }
 121   3                      }
 122   2      #if GENERATE_TS_KEY_EN
 123   2      /*************************************************************************************************
 124   2      ±äÁ¿TS_KeyÊÇ¸ù¾ÝKeysFlagSNµÃµ½µÄ°´¼üÐÅÏ¢£¬ÒÔÏÂÎª°´¼ü²úÉúµÄ¹ý³Ì£º
 125   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------|
 126   2      |       µ¥¼ü£ºÒÔK1ÎªÀý£¬K1°´¼ü²úÉúµÄÁ÷³ÌÈçÏÂËùÊ¾£º                                                                                                                                                                                                                                                                                                                                                              |
 127   2      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
 128   2      |                                               |---> K1|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                                                                                                                                                                                                                                                                                                            |
 129   2      |       K1(°´ÏÂ)--|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
 130   2      |                                               |---> K1|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> K1|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉúÒ»´Î³¤°´¼ü)---->K1|KEY
             -_LONG_BREAK(³¤°´ËÉ¿ª) |
 131   2      |                                                                                                                                                                                                ^                                                                                                                                                                                          |                                                                                                                           |
 132   2      |                                                                                                                                                                                                |                                                                                                                                                                                          |                                                                                                                           |
 133   2      |                                                                                                                                                                                                |----------<-----------<------------<--------------|                                                                                                                           |
 134   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------|
 135   2      
 136   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
 137   2      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
 138   2      |       ¸´ºÏ¼ü£ºÒÔK1(K1=0x0001),K2(K2=0x0002)ÎªÀý£¬ µ±K1£¬K2Í¬Ê±°´ÏÂÊ±£¬²úÉú°´¼üÎª(K1<<5)|K2£¬¼´0x22, ²úÉú°´¼üµÄ
             -Á÷³ÌÈçÏÂËùÊ¾£º                                                                                                                                                                                                |
 139   2      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
 140   2      |                                                                               |---> ((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
 141   2      |       (K1<<5)|K2(°´ÏÂ)--|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
 142   2      |                                                                               |---> ((K1<<5)|K2)|KEY_LONG_START(³¤°´´óÔ¼1Ãë)---> ((K1<<5)|K2)|KEY_LONG(Ò»Ö±³¤°´£¬Ô¼Ã¿300ms²úÉ
             -ú³¤°´¼ü)---->((K1<<5)|K2)|KEY_LONG_BREAK(³¤°´ËÉ¿ª)            |
 143   2      |                                                                                                                                                                                                                                                                        ^                                                                                                                                                                                                 |                                                                                                                                                                    |
 144   2      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                 |                                                                                                                                                                    |
 145   2      |                                                                                                                                                                                                                                                                        |---------<-------------<----------------<----------------|                                                                                    
             -                                                                                |
 146   2      |---------------------------------------------------------------------------------------------------------
             ---------------------------------------------------------------|
 147   2                                                                                                                                                                                                                                                               
 148   2      ×¢Òâ£ºÓÉÓÚ¸´ºÏ¼ü°´ÏÂÊ±£¬Èí¼þ²»Ò»¶¨Í¬Ê±¼ì²âµ½Ë«¼ü£¬¶øÊÇÏÈ¼ì²âµ½µ¥¼ü°´ÏÂ£¬ÀýÈçÏÈ¼ì²âµ½K1£¬´ËÊ±»áÏÈ²úÉúK1¼ü£¬
             -µÈµ½¼ì²âµ½K2Ò²°´
 149   2      ÏÂÊ±£¬²Å»á²úÉú°´¼ü(K1<<5)|K2£¬¼ì²âµ½Ë«¼üºó£¬Èç¹ûË«¼üÒ»Ö±°´ÏÂ£¬»á²úÉú((K1<<5)|K2)|KEY_LONG_STARTºÍ((K1<<5)|
             -K2)|KEY_LONG£¬Èç¹û
 150   2      ÓÐÒ»¸ö¼üÏÈËÉÊÖ£¬»áÍ£Ö¹²úÉú°´¼ü£¬ µÈµ½Ë«¼ü¶¼ËÉ¿ªÊ±£¬²Å»á²úÉú((K1<<5)|K2)|KEY_BREAK(¶Ì°´ËÉ¿ª)»ò((K1<<5)|K2)|
C51 COMPILER V9.02   MAIN                                                                  05/12/2022 13:56:07 PAGE 4   

             -KEY_LONG_BREAK(³¤°´ËÉ¿ª)
 151   2      *************************************************************************************************/
 152   2                      if(TS_Key != 0)
 153   2                      {
 154   3                              switch(TS_Key)
 155   3                              {
 156   4      //µ¥°´¼üÏûÏ¢
 157   4                                      case K1:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢                  
 158   4                                              break;
 159   4                                      case (K1|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 160   4                                              break;
 161   4                                      case (K1|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 162   4                                              break;
 163   4                                      case (K1|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 164   4                                              break;
 165   4                                      case (K1|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 166   4                                              break;
 167   4      //µ¥°´¼üÏûÏ¢
 168   4                                      case K2:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 169   4                                              break;
 170   4                                      case (K2|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 171   4                                              break;
 172   4                                      case (K2|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 173   4                                              break;
 174   4                                      case (K2|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 175   4                                              break;
 176   4                                      case (K2|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 177   4                                              break;
 178   4      //µ¥°´¼üÏûÏ¢
 179   4                                      case K3:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 180   4                                              break;
 181   4                                      case (K3|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 182   4                                              break;
 183   4                                      case (K3|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 184   4                                              break;
 185   4                                      case (K3|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 186   4                                              break;
 187   4                                      case (K3|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 188   4                                              break;
 189   4      //µ¥°´¼üÏûÏ¢
 190   4                                      case K4:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 191   4                                              break;
 192   4                                      case (K4|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 193   4                                              break;
 194   4                                      case (K4|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 195   4                                              break;
 196   4                                      case (K4|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 197   4                                              break;
 198   4                                      case (K4|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 199   4                                              break;
 200   4      //µ¥°´¼üÏûÏ¢
 201   4                                      case K5:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 202   4                                              break;
 203   4                                      case (K5|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 204   4                                              break;
 205   4                                      case (K5|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 206   4                                              break;
 207   4                                      case (K5|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 208   4                                              break;
 209   4                                      case (K5|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 210   4                                              break;
 211   4      //µ¥°´¼üÏûÏ¢
C51 COMPILER V9.02   MAIN                                                                  05/12/2022 13:56:07 PAGE 5   

 212   4                                      case K6:                                        //K1¶Ì°´²úÉúµÄ°´¼üÏûÏ¢
 213   4                                              break;
 214   4                                      case (K6|KEY_BREAK):            //K1¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
 215   4                                              break;
 216   4                                      case (K6|KEY_LONG_START):       //K1³¤°´¿ªÊ¼²úÉúµÄÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
 217   4                                              break;
 218   4                                      case (K6|KEY_LONG):                     //K1³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
 219   4                                              break;
 220   4                                      case (K6|KEY_LONG_BREAK):       //K1³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
 221   4                                              break;
 222   4      #if GENERATE_DOUBLE_KEY_EN
                      //¸´ºÏ¼üÏûÏ¢
                                              case (K1<<5)|K2:                                                //K1ºÍK2Í¬Ê±°´ÏÂÊ±²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case ((K1<<5)|K2)|KEY_BREAK:                    //K1ºÍK2¶Ì°´ËÉÊÖ²úÉúµÄ°´¼üÏûÏ¢
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG_START:               //K1ºÍK2³¤°´¿ªÊ¼²úÉúµÄ°´¼üÏûÏ¢£¨³¤°´Ô¼1ÃëÊ±²úÉú£©
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG:                             //K1ºÍK2³¤°´²úÉúµÄÏûÏ¢£¨Ã¿¸ôÔ¼300ms²úÉúÒ»´Î£©
                                                      break;
                                              case ((K1<<5)|K2)|KEY_LONG_BREAK:               //K1ºÍK2³¤°´ËÉÊÖ²úÉúµÄÏûÏ¢
                                                      break;
              #endif
 235   4                              }
 236   3                      }
 237   2      #endif
 238   2      #endif
 239   2              }
 240   1      }
 241          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     87    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
